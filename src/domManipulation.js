const domManipulation = (() => {
  const drawPlayerBoard = (board) => {
    const playerBoard = document.getElementById('player-board');
    const boardArr = board.getBoard();
    for (let i = 0; i < 10; i++) {
      const row = document.createElement('div');
      row.classList.add('row');
      for (let j = 0; j < 10; j++) {
        const cell = document.createElement('div');
        cell.classList.add('gameboard-cell');
        cell.dataset.row = i;
        cell.dataset.col = j;
        row.appendChild(cell);
      }
      playerBoard.appendChild(row);
    }
  };

  const drawComputerBoard = (board) => {
    const computerBoard = document.getElementById('computer-board');
    const boardArr = board.getBoard();
    for (let i = 0; i < 10; i++) {
      const row = document.createElement('div');
      row.classList.add('row');
      for (let j = 0; j < 10; j++) {
        const cell = document.createElement('div');
        cell.classList.add('gameboard-cell');
        cell.dataset.row = i;
        cell.dataset.col = j;
        if (boardArr[i][j] == 'H' || boardArr[i][j] == 'M') {
          cell.textContent = boardArr[i][j];
        }
        row.appendChild(cell);
      }
      computerBoard.appendChild(row);
    }
  };

  const updateCell = (board, x, y, computer) => {
    const boardArr = board.getBoard();
    let cells;
    if (computer) {
      cells = Array.from(
        document.querySelectorAll('#computer-board > * > .gameboard-cell')
      );
    } else {
      cells = Array.from(
        document.querySelectorAll('#player-board > * > .gameboard-cell')
      );
    }
    cells.forEach((cell) => {
      if (
        parseInt(cell.dataset.row) === x &&
        parseInt(cell.dataset.col) === y
      ) {
        if (boardArr[x][y] === 'M') {
          const missElement = document.createElement('div');
          missElement.classList.add('miss');
          cell.appendChild(missElement);
        } else if (boardArr[x][y] === 'S') {
          cell.classList.add('ship');
        } else if (boardArr[x][y] === 'H') {
          cell.classList.add('hit');
        }
      }
    });
  };

  const drawShipSelector = (player) => {
    const shipSelector = document.getElementById('ship-selector');

    const shipCoordInput = document.createElement('input');
    shipCoordInput.setAttribute('id', 'ship-coord-input');
    shipCoordInput.type = 'text';
    shipCoordInput.placeholder = 'Input coordinate (e.g. A10)';

    const shipTypeSelect = document.createElement('select');
    shipTypeSelect.setAttribute('id', 'ship-type-select');
    player.getShips().forEach((ship) => {
      const opt = document.createElement('option');
      opt.value = ship.getName();
      opt.textContent = ship.getName();
      shipTypeSelect.appendChild(opt);
    });

    const horizontalRadioContainer = document.createElement('div');
    const horizontalRadio = document.createElement('input');
    horizontalRadio.type = 'radio';
    horizontalRadio.name = 'direction';
    horizontalRadio.value = 'horizontal';
    const horizontalLabel = document.createElement('label');
    horizontalLabel.textContent = 'Horizontal';
    horizontalRadioContainer.appendChild(horizontalRadio);
    horizontalRadioContainer.appendChild(horizontalLabel);

    const verticalRadioContainer = document.createElement('div');
    const verticalRadio = document.createElement('input');
    verticalRadio.type = 'radio';
    verticalRadio.name = 'direction';
    verticalRadio.value = 'vertical';
    const verticalLabel = document.createElement('label');
    verticalLabel.textContent = 'Vertical';
    verticalRadioContainer.appendChild(verticalRadio);
    verticalRadioContainer.appendChild(verticalLabel);

    const submitButton = document.createElement('button');
    submitButton.setAttribute('id', 'submit-ship-button');
    submitButton.textContent = 'Place Ship!';

    shipSelector.appendChild(shipCoordInput);
    shipSelector.appendChild(shipTypeSelect);
    shipSelector.appendChild(horizontalRadioContainer);
    shipSelector.appendChild(verticalRadioContainer);
    shipSelector.appendChild(submitButton);
  };

  const drawAttackCoordinateSelector = () => {
    const attackSelector = document.getElementById('attack-coord-selector');

    const attackInput = document.createElement('input');
    attackInput.setAttribute('id', 'attack-input');
    attackInput.type = 'text';
    attackInput.placeholder = 'Enter attack coordinate (e.g. A10)';

    const submitButton = document.createElement('button');
    submitButton.setAttribute('id', 'submit-attack-button');
    submitButton.textContent = 'Attack a square!';

    attackSelector.appendChild(attackInput);
    attackSelector.appendChild(submitButton);
  };

  return {
    drawPlayerBoard,
    drawComputerBoard,
    drawShipSelector,
    drawAttackCoordinateSelector,
    updateCell,
  };
})();

export default domManipulation;
